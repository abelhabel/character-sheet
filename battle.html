<!DOCTYPE html>
<html>
<head>
  <script>
    class Module {
      constructor(name) {
        this.name = name;
        this.module = '';
        Module.modules[name] = this;
      }

      get exports() {
        return this.module;
      }

      set exports(n) {
        this.module = n;
        Module.loaders.forEach(l => l());
      }

      static onLoad(files, fn) {
        var index = -1 + this.loaders.push(
          () => {
            var loaded = files.filter(f => {
              return this.modules[f];
            });
            if(loaded.length == files.length) {
              fn();
              this.loaders.splice(index, 1);
            }
          }
        )
      }
    }

    function require(name) {
      return Module.modules[name] && Module.modules[name].module || null;
    }
    Module.modules = {};
    Module.loaders = [];
    Module.onLoad(['monsters.js', 'PositionList2d.js', 'Battle.js', 'pathfinding.js'], () => {
      const PL = require('PositionList2d.js');
      const monsters = require('monsters.js');
      const Battle = require('Battle.js');
      var undead = monsters.filter(m => m.nameAndFamily.family == 'Undead');
      var beasts = monsters.filter(m => m.nameAndFamily.family == 'Beasts');
      beasts.forEach(a => a.ai = true)
      undead.forEach(a => a.ai = true)
      var w = h = 8;
      h = 10;
      var tw = th = 32;
      var canvas = document.createElement('canvas');
      var initiative = document.createElement('canvas');
      canvas.style.display = initiative.style.display = 'block';
      canvas.style.border = initiative.style.border = '1px solid green';
      canvas.width = canvas.height = w * tw;
      initiative.width = (undead.length + beasts.length) * tw;
      initiative.height = th;
      document.body.appendChild(canvas);
      document.body.appendChild(initiative);
      var battle = new Battle(undead, beasts, w, h, tw, th, canvas, initiative);
      battle.start();
    })
  </script>
</head>
<body>
  <script src='pathfinding.js'></script>
  <script src='monsters.js'></script>
  <script src='PositionList2d.js'></script>
  <script src='Battle.js'></script>
</body>
</html>
